[build]
  command = "npm install --legacy-peer-deps && npm run build"
  publish = "dist"

[build.environment]
  NODE_VERSION = "22"
  NPM_FLAGS = "--legacy-peer-deps"
  # These env vars are intentionally in the client bundle or source files.
  # SANITY_API_TOKEN: server-side only, never in client JS.
  # VITE_SANITY_DATASET / VITE_SANITY_PROJECT_ID: public Sanity config,
  # embedded by Vite into client JS by design (safe, not secrets).
  SECRETS_SCAN_OMIT_KEYS = "SANITY_API_TOKEN,VITE_SANITY_DATASET,VITE_SANITY_PROJECT_ID"

# www â†’ apex redirect (canonical URL for SEO)
[[redirects]]
  from = "https://www.drhaithamsharshar.com/*"
  to = "https://drhaithamsharshar.com/:splat"
  status = 301
  force = true

# SPA catch-all
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# Prerendering: serve pre-rendered HTML to search engines & social crawlers
# This ensures Google, Facebook, Twitter, WhatsApp see full page content
# instead of an empty <div id="root"></div>
# Note: Requires Netlify Pro plan. On free plan, this is silently ignored.
[build.processing.html]
  pretty_urls = true

[build.processing]
  skip_processing = false

[[plugins]]
  package = "@netlify/plugin-lighthouse"

# Bot prerendering (Netlify Pro feature)
[build.processing.images]
  compress = true
