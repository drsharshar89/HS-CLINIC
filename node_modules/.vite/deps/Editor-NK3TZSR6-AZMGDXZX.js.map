{
  "version": 3,
  "sources": ["../../@puckeditor/core/dist/Editor-NK3TZSR6.mjs"],
  "sourcesContent": ["import {\n  PuckRichText\n} from \"./chunk-2CNEFIQP.mjs\";\nimport {\n  EditorInner,\n  LoadedRichTextMenu\n} from \"./chunk-RHVK562Z.mjs\";\nimport \"./chunk-AOEDIUVK.mjs\";\nimport \"./chunk-5V242HXR.mjs\";\nimport \"./chunk-MSZPUXZP.mjs\";\nimport \"./chunk-KOUWDQ4Q.mjs\";\nimport \"./chunk-SKJTJUWU.mjs\";\nimport {\n  useAppStore,\n  useAppStoreApi\n} from \"./chunk-UMTU6EA7.mjs\";\nimport \"./chunk-37HTE4KO.mjs\";\nimport \"./chunk-MDUBGHWF.mjs\";\nimport \"./chunk-Y2EFNT5P.mjs\";\nimport \"./chunk-PMXRXC2B.mjs\";\nimport {\n  __spreadProps,\n  __spreadValues,\n  init_react_import\n} from \"./chunk-M6W7YEVX.mjs\";\n\n// components/RichTextEditor/components/Editor.tsx\ninit_react_import();\nimport { memo, useMemo } from \"react\";\n\n// components/RichTextEditor/lib/use-synced-editor.ts\ninit_react_import();\nimport { useEditor } from \"@tiptap/react\";\nimport { useEffect, useRef } from \"react\";\nimport { useDebounce } from \"use-debounce\";\nfunction useSyncedEditor({\n  content,\n  onChange,\n  extensions,\n  editable = true,\n  onFocusChange,\n  name\n}) {\n  const [debouncedState, setDebouncedState] = useDebounce(null, 50, {\n    leading: true,\n    maxWait: 200\n  });\n  const syncingRef = useRef(false);\n  const lastSyncedRef = useRef(\"\");\n  const editTimer = useRef(null);\n  const isPending = !!editTimer.current;\n  const isFocused = useAppStore((s) => s.state.ui.field.focus === name);\n  const resetTimer = (clearOn) => {\n    if (editTimer.current) {\n      clearTimeout(editTimer.current);\n    }\n    editTimer.current = setTimeout(() => {\n      if (lastSyncedRef.current === clearOn) {\n        editTimer.current = null;\n      }\n    }, 200);\n  };\n  const appStoreApi = useAppStoreApi();\n  const editor = useEditor({\n    extensions,\n    content,\n    editable,\n    immediatelyRender: false,\n    parseOptions: { preserveWhitespace: \"full\" },\n    onUpdate: ({ editor: editor2 }) => {\n      if (syncingRef.current || !isFocused) {\n        appStoreApi.getState().setUi({ field: { focus: name } });\n        return;\n      }\n      const html = editor2.getHTML();\n      const { from, to } = editor2.state.selection;\n      setDebouncedState({ from, to, html });\n      resetTimer(html);\n      lastSyncedRef.current = html;\n    }\n  });\n  useEffect(() => {\n    if (!editor) return;\n    const handleFocus = () => {\n      onFocusChange == null ? void 0 : onFocusChange(editor);\n    };\n    editor.on(\"focus\", handleFocus);\n    return () => {\n      editor.off(\"focus\", handleFocus);\n    };\n  }, [editor, onFocusChange]);\n  useEffect(() => {\n    if (debouncedState) {\n      const { ui } = appStoreApi.getState().state;\n      onChange(debouncedState.html, {\n        field: __spreadProps(__spreadValues({}, ui.field), {\n          metadata: { from: debouncedState.from, to: debouncedState.to }\n        })\n      });\n    }\n  }, [editor, debouncedState, onChange, appStoreApi, name]);\n  useEffect(() => {\n    editor == null ? void 0 : editor.setEditable(editable);\n  }, [editor, editable]);\n  useEffect(() => {\n    var _a;\n    if (!editor) return;\n    if (isPending) {\n      return;\n    }\n    const current = editor.getHTML();\n    if (current === content) return;\n    syncingRef.current = true;\n    editor.commands.setContent(content, { emitUpdate: false });\n    const { ui } = appStoreApi.getState().state;\n    if (typeof ((_a = ui.field.metadata) == null ? void 0 : _a.from) !== \"undefined\") {\n      editor.commands.setTextSelection({\n        from: ui.field.metadata.from,\n        to: ui.field.metadata.to\n      });\n    }\n    syncingRef.current = false;\n  }, [content, editor, appStoreApi]);\n  return editor;\n}\n\n// components/RichTextEditor/components/Editor.tsx\nimport { EditorContent } from \"@tiptap/react\";\nimport { jsx } from \"react/jsx-runtime\";\nvar Editor = memo((props) => {\n  const {\n    onChange,\n    content,\n    readOnly = false,\n    field,\n    inline = false,\n    onFocus,\n    id,\n    name\n  } = props;\n  const { tiptap = {}, options } = field;\n  const { extensions = [] } = tiptap;\n  const loadedExtensions = useMemo(\n    () => [PuckRichText.configure(options), ...extensions],\n    [field, extensions]\n  );\n  const appStoreApi = useAppStoreApi();\n  const focusName = `${name}${inline ? \"::inline\" : \"\"}`;\n  const editor = useSyncedEditor({\n    content,\n    onChange,\n    extensions: loadedExtensions,\n    editable: !readOnly,\n    name: focusName,\n    onFocusChange: (editor2) => {\n      if (editor2) {\n        const s = appStoreApi.getState();\n        appStoreApi.setState({\n          currentRichText: {\n            field,\n            editor: editor2,\n            id,\n            inline\n          },\n          state: __spreadProps(__spreadValues({}, s.state), {\n            ui: __spreadProps(__spreadValues({}, s.state.ui), {\n              field: __spreadProps(__spreadValues({}, s.state.ui.field), {\n                focus: focusName\n              })\n            })\n          })\n        });\n        onFocus == null ? void 0 : onFocus(editor2);\n      }\n    }\n  });\n  const menuEditor = useAppStore((s) => {\n    var _a, _b;\n    if (!inline && ((_a = s.currentRichText) == null ? void 0 : _a.id) === id && ((_b = s.currentRichText) == null ? void 0 : _b.inlineComponentId)) {\n      return s.currentRichText.editor;\n    }\n    return editor;\n  });\n  if (!editor) return null;\n  return /* @__PURE__ */ jsx(\n    EditorInner,\n    __spreadProps(__spreadValues({}, props), {\n      editor,\n      menu: /* @__PURE__ */ jsx(\n        LoadedRichTextMenu,\n        {\n          field,\n          editor: menuEditor,\n          readOnly\n        }\n      ),\n      children: /* @__PURE__ */ jsx(EditorContent, { editor, className: \"rich-text\" })\n    })\n  );\n});\nEditor.displayName = \"Editor\";\nexport {\n  Editor\n};\n"],
  "mappings": "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",
  "names": ["import_react"]
}
